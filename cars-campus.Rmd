---
title: "Where is that car from?"
author: "Brianna Saylor"
date: "`r Sys.Date()`"
output: 
 html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
pacman::p_load("ggspatial","leaflet","OpenStreetMap","raster","sf","terra","terrainr","tidyterra","tidyverse", "maps")
library(dplyr) # data manipulation
library(ggplot2) # making graphs
library(tidyverse)  # importing, tidying, plotting data
library(knitr)      # making tables in markdown
library(leaflet)    # making maps in markdown 
library(hexbin)
cars <- read.csv("data/cars_response_form.csv")
```

```{r clean up data, include=FALSE}
cars <- cars %>% 
  rename( # rename columns 
    lat = Latitude..the.x.coordinate..a.positive.value, 
    lon = Longitude..the.y.coordinate..a.negative.value, 
    state = Where.is.the.car.from, 
    color = What.color.is.the.car)
cars$state <- as.factor(cars$state)
cars$color <- as.factor(cars$color)
summary(cars)
unique(cars$state)
unique(cars$color)
```

```{r static map}
# use min/max lat/long to set map imagery boundaries
buffer <- 0.001
min_lat <- min(cars$lat) - buffer
max_lat <- max(cars$lat) + buffer
min_lon <- min(cars$lon) - buffer
max_lon <- max(cars$lon) + buffer
CampusMap <- openmap(
  upperLeft = c(max_lat, min_lon),   
  lowerRight = c(min_lat, max_lon),  
  type = "esri-imagery", zoom = 18, mergeTiles = TRUE)
APSU <- openproj(CampusMap, projection = "+proj=longlat +ellps=WGS84 +units=m +no_defs")
```

```{r}
library(ggimage)
autoplot.OpenStreetMap(APSU) + 
 geom_text(
    data = cars,
    aes(x = lon, y = lat),
    label = "ðŸš—",           # the car icon
    size = 4,               # adjust icon size
    alpha = 1) + 
  labs(x = "Longitude", y = "Latitude") 

library(ggimage)
cars$car_icon <- "car_icon.png"
autoplot.OpenStreetMap(APSU) +
  geom_image(
    data = cars,
    aes(x = lon, y = lat, image = car_icon),
    size = 0.05,
    asp = 1.5
  ) +
  labs(x = "Longitude", y = "Latitude")
```


```{r interactive map}
library(RColorBrewer)
pal <- colorFactor(
  palette = colorRampPalette(brewer.pal(12, "Set3"))(19),
  domain = cars$state
)

leaflet(cars) %>% 
  addTiles() %>% 
  addProviderTiles("OpenStreetMap", group = "Streets") %>% 
  addProviderTiles("Esri.WorldImagery", group = "Imagery") %>% 
  addLayersControl(baseGroups = c("Streets", "Imagery"), 
                   options = layersControlOptions(collapsed = FALSE)) %>% 
  addScaleBar() %>% 
  addCircleMarkers(
    lng = ~lon, 
    lat = ~lat,
    color = ~pal(state),      # colors by state
    fillColor = ~pal(state),
    fillOpacity = 0.9,
    radius = 6,
    stroke = FALSE,
    label = ~state) %>%
  addLegend(
    "bottomright",
    pal = pal,
    values = ~state,
    title = "State",
    opacity = 1)
```

